# ABCare SDF 작업 가이드

작성일: 2025-12-16
기반: 복약기록(MEDL) SDF 작업 경험

---

## 1. 작업 프로세스 개요

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                           SDF 작업 플로우                                      │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                               │
│   Step 1           Step 2           Step 3           Step 4           Step 5 │
│   ──────────────────────────────────────────────────────────────────────     │
│                                                                               │
│   SRS 원문 확인  →  코드 분석     →  리팩토링 검토  →  초안 작성    →  검토/반영│
│   (Google Docs)    (patient-app)   (구조 정리)      (로컬 .md)      (Sheets)  │
│                                                                               │
│   • SRS ID 확인    • 화면 파일     • 컴포넌트 분리   • 함수 매핑     • Anthony │
│   • 요구사항 파악   • 컴포넌트      • 폴더 이동       • SDS ID 부여   • 수정반영│
│   • 세부항목 체크   • hooks/API     • hooks 분리     • 설명 작성     • Sheets  │
│                                                                               │
└──────────────────────────────────────────────────────────────────────────────┘
```

### ⚠️ Step 3 리팩토링 검토 (중요)

**SDF 초안 작성 전에 반드시 리팩토링 필요 여부를 먼저 검토**해야 한다.

이유:
- 리팩토링 후 파일 경로, 함수명이 변경될 수 있음
- SDF 작성 후 리팩토링하면 문서 수정 작업이 중복됨
- 코드 구조가 정리된 상태에서 SDF 작성이 더 명확함

**검토 항목**:
- [ ] 화면 파일이 500줄 이상인가? → 컴포넌트 분리 검토
- [ ] 재사용 가능한 컴포넌트가 화면 내부에 있는가? → 분리 검토
- [ ] 비즈니스 로직이 화면에 직접 있는가? → hooks 분리 검토
- [ ] console.log 등 정리 대상이 있는가? → 삭제

**결정**: 리팩토링이 필요하면 먼저 진행, 불필요하면 바로 Step 4로

---

## 2. 핵심 원칙 (⚠️ 중요)

### 2.1 SRS 원문 준수
```
❌ 절대 하면 안 되는 것:
   - 코드에서 본 기능을 SRS 요구사항인 것처럼 추가
   - SRS에 없는 상세 내용 임의로 넣기 (색상, 캘린더, 계획 대비 등)

✅ 올바른 접근:
   SRS 원문 그대로 + 구현 함수 매핑만
```

**이유**: 식약처 심사 시 SRS ↔ SDF ↔ 테스트 추적성 검증

### 2.2 용어 통일
| 사용 ❌ | 사용 ✅ |
|--------|--------|
| 표시한다 | **출력한다** |
| 보여준다 | **출력한다** |
| 나타낸다 | **출력한다** |
| 가져온다 | **조회하여 반환한다** |

### 2.3 함수명 네이밍 규칙
| 유형 | 패턴 | 예시 |
|------|------|------|
| Screen 컴포넌트 | `[Screen명].render()` | `MyRecordsMonthlyScreen.render()` |
| 일반 컴포넌트 | `[컴포넌트명].render()` | `TakenHistorySummaryCard.render()` |
| Custom Hook | `use[기능명]()` | `useGetDailyTakenHistory()` |
| 유틸 함수 | `[동사][명사]()` | `inferMedicationTypeById()` |
| API 호출 | `fetch[자원명]()` | `fetchMedicationLogs()` |

---

## 3. ID 체계

### SRS ID
```
SRS_PA_MYPG_MEDL_001
│   │  │     │    │
│   │  │     │    └─ 순번
│   │  │     └────── 세부 기능 (MEDL=복약기록, PAIL=통증기록)
│   │  └──────────── 기능 그룹 (MYPG=마이페이지)
│   └─────────────── 플랫폼 (PA=Patient App)
└──────────────────── 문서 유형
```

### SDS ID
```
SDS_PA_MYPG_MEDL_001
│   │  │     │    │
│   │  │     │    └─ 순번 (연속 번호, SRS와 1:N 관계)
│   │  │     └────── 세부 기능
│   │  └──────────── 기능 그룹
│   └─────────────── 플랫폼
└──────────────────── 문서 유형 (SDS=Software Design Spec)
```

**주의**: SDS 순번은 **전체 기능에서 연속**으로 부여
- 예: MEDL이 001-011 사용 → PAIL은 012부터 시작

---

## 4. 파일 위치

### 4.1 참조 문서
| 문서 | 위치 |
|------|------|
| SRS (요구사항) | [Google Docs](https://docs.google.com/document/d/1vBlcPlECSGd5fz0SxNnLcloS0kxP32SzyB1ILR3kFLc/edit) |
| SDF (상세설계) | [Google Sheets](https://docs.google.com/spreadsheets/d/1X3_srci8M4RNIIFhasAY1o8ltA9vHkiSav_Zx4RyLpk/edit) |
| 작업 가이드 | `/develop-doc/gmp/ABCare/sdf-workflow.md` |
| 코드 아키텍처 | `/patient-app/guide/README.md` |

### 4.2 코드 아키텍처

```
patient-app/
├── app/                      # 화면 구성만 (Layout, 컴포넌트 조합)
│   └── (tabs)/mypage/       # 마이페이지 화면들
│       ├── _layout.tsx      # 레이아웃 설정
│       ├── my-records.tsx   # 화면: 컴포넌트 import & 조합
│       └── ...
│
├── src/
│   ├── features/            # 기능별 로직 + 컴포넌트 (권장)
│   │   ├── medication/      # 복약 관련
│   │   └── pain/            # 통증 관련
│   │
│   ├── components/common/   # 프로젝트 내 공용 컴포넌트
│   └── api/                 # API 호출, hooks
│
└── lib/                      # 사내 공용 라이브러리 (추후 분리 예정)
```

**SDF 파일 경로 매핑 기준**:
| 유형 | 경로 패턴 |
|------|----------|
| 화면 렌더 | `app/(tabs)/[그룹]/[화면].tsx` |
| 기능별 컴포넌트 | `src/features/[기능]/components/` |
| 기능별 hooks | `src/features/[기능]/hooks/` |
| 공용 컴포넌트 | `src/components/common/` |
| API hooks | `src/api/` |
| 사내 공용 | `lib/` |

### 4.3 현재 파일 위치 (레거시)
> ⚠️ 기존 코드는 아래 위치에 있으나, SDF 작업 시 리팩토링 권장

| 유형 | 현재 경로 | 권장 경로 |
|------|----------|----------|
| 마이페이지 화면 | `app/(tabs)/mypage/` | 유지 |
| 공용 컴포넌트 | `src/components/common/` | 유지 또는 `src/features/` |
| API/Hooks | `src/api/` | `src/features/[기능]/hooks/` |
| 유틸 함수 | `lib/` | 유지 (공용) 또는 `src/features/` |

### 4.3 SDF 초안
```
/develop-doc/gmp/ABCare/sdf/
└── 마이페이지/
    ├── 복약기록-SDF-초안.md  ✅ 완료
    └── 통증기록-SDF-초안.md  ⏳ 다음 작업
```

---

## 5. 작업 체크리스트

### 5.1 시작 전
- [ ] SRS 문서에서 해당 기능 SRS ID 확인
- [ ] SRS 원문 복사해두기
- [ ] 관련 화면 파일 위치 파악

### 5.2 코드 분석
- [ ] 메인 화면 파일 읽기
- [ ] 사용된 컴포넌트 목록 정리
- [ ] Custom hooks 확인
- [ ] API 호출 확인

### 5.3 초안 작성
- [ ] SRS 원문 그대로 "기능 설명"에 사용
- [ ] 각 함수에 SDS ID 부여 (연속 번호)
- [ ] 함수 기능 설명 작성 ("출력한다", "반환한다" 용어 사용)
- [ ] 파일 경로 매핑

### 5.4 검토
- [ ] SRS 세부 항목 모두 커버되는지 확인
- [ ] 불필요한 상세 내용 없는지 확인
- [ ] 용어 통일 확인

### 5.5 반영
- [ ] Anthony 컨펌 받기
- [ ] Google Sheets에 입력
- [ ] 셀 병합 등 서식 처리

---

## 6. 마이페이지 SRS 구조 (참고)

| SRS ID | 기능명 | 상태 |
|--------|--------|------|
| SRS_PA_MYPG_MEDL_001 | 복약 기록 요약 정보 | ✅ 완료 |
| SRS_PA_MYPG_MEDL_002 | 복약 기록 타임라인 | ✅ 완료 |
| SRS_PA_MYPG_PAIL_001 | 통증 기록 요약 정보 | ⏳ 다음 |
| SRS_PA_MYPG_PAIL_002 | 통증 추이 그래프 | ⏳ 대기 |
| SRS_PA_MYPG_PAIL_003 | 빠른 약제 복약 기록 | ⏳ 대기 |

---

## 7. SDF 작업 시 코드 정리 (병행 작업)

SDF 문서화하면서 발견되는 코드 이슈를 함께 정리:

### 7.1 console.log 삭제

```bash
# 삭제 대상
console.log()
console.warn()
console.debug()
console.info()

# 유지 (허용)
console.error()  # 에러 로깅은 유지
```

**작업 방법**:
```bash
# 해당 파일에서 console.log 검색
grep -n "console.log" [파일경로]

# 삭제 후 lint 확인
bun lint
```

### 7.2 코드 리팩토링 (선택)

SDF 문서화 과정에서 아키텍처 정리 가능:

| 작업 | 설명 | 주의사항 |
|------|------|---------|
| 컴포넌트 분리 | 큰 파일 → 작은 컴포넌트 | 로직 변경 없이 구조만 |
| 폴더 이동 | `src/components/` → `src/features/` | import 경로 수정 |
| hooks 분리 | 화면에서 hook으로 로직 추출 | 동작 동일 유지 |

**⚠️ 중요**:
- **로직 수정 절대 금지** (버그 수정도 안 됨)
- 구조적 분리/이동만 허용
- SDF 작성 범위 내에서만 정리

### 7.3 정리 체크리스트

```
□ console.log 삭제
□ 불필요한 주석 제거
□ 미사용 import 제거
□ 컴포넌트 분리 (필요시)
□ lint 통과 확인
```

---

## 8. 컴포넌트 분리 기준

SDF 문서화를 위해 컴포넌트 분리가 필요한 경우:

### 분리 O
- SRS 요구사항에 명시된 독립적 기능 단위
- 재사용 가능한 UI 블록
- 예: `TakenHistorySummaryCard` (복약 요약 카드)

### 분리 X
- 단순 스타일링 래퍼
- 한 곳에서만 사용되는 내부 렌더 함수
- 로직 없는 레이아웃 컴포넌트

**주의**: 로직 수정 없이 구조적 분리만 허용

---

## 8. Google Sheets 입력 규칙

### 8.1 컬럼 구조
| A | B | C | D | E | F |
|---|---|---|---|---|---|
| SRS ID | 주요 기능 | 기능 설명 | SDS ID | 함수명 | 함수 기능 설명 |

### 8.2 셀 병합
- A, B, C 컬럼: 같은 SRS ID 그룹끼리 병합
- D, E, F 컬럼: 병합 안 함 (각 함수별 1행)

### 8.3 데이터 위치
- 위아래 10행 버퍼 유지
- 현재 복약기록: Row 15-25
- 통증기록: Row 26~ (예상)

---

## 9. 트러블슈팅

### Q: SRS에 없는 기능이 코드에 있으면?
A: SDF에 포함하지 않음. SRS 추적성이 깨짐.

### Q: 컴포넌트 내부 함수도 다 적어야 하나?
A: SRS 요구사항 충족에 필요한 함수만. 내부 헬퍼는 생략 가능.

### Q: 함수 설명이 너무 길어지면?
A: 핵심만 간결하게. "~를 ~하여 출력한다" 패턴.

### Q: API 호출과 데이터 가공이 분리되어 있으면?
A: 보통 hook 하나로 묶어서 기술. 세부 분리는 선택적.

---

## 10. 다음 작업: 통증기록 (PAIL)

### 예상 SRS 항목
1. `SRS_PA_MYPG_PAIL_001`: 통증 기록 요약 정보
2. `SRS_PA_MYPG_PAIL_002`: 통증 추이 그래프
3. `SRS_PA_MYPG_PAIL_003`: 빠른 약제 복약 기록

### 관련 파일 (예상)
- `app/(tabs)/mypage/my-records.tsx` (통증 탭 포함 가능)
- `src/components/common/PainRecord*.tsx`
- 통증 관련 hooks

### SDS ID 시작점
- MEDL이 001-011 사용
- **PAIL은 012부터 시작**

---

## 수정 이력

| 날짜 | 작성자 | 내용 |
|------|-------|------|
| 2025-12-16 | Claude Code | 초안 작성 (복약기록 경험 기반) |
